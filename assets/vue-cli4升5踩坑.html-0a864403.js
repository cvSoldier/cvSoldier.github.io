import{_ as t,W as o,X as c,Y as s,Z as n,$ as e,a0 as p,C as i}from"./framework-c8ebc670.js";const l={},r=p(`<blockquote><p>å‡çº§åŸå› ï¼šwebpack5 çš„ cache å¤ªå¤ªå¤ªé¦™äº†</p></blockquote><h3 id="_1ã€npm-run-build-æ‰§è¡Œä¸¤éæ‰“åŒ…" tabindex="-1"><a class="header-anchor" href="#_1ã€npm-run-build-æ‰§è¡Œä¸¤éæ‰“åŒ…" aria-hidden="true">#</a> 1ã€npm run build æ‰§è¡Œä¸¤éæ‰“åŒ…</h3><p>vue-cli5 é»˜è®¤ä¼šä¸ºç°ä»£æµè§ˆå™¨é¢å¤–æ‰“ä¸€ä¸ª <code>&lt;script type=&quot;module&quot;&gt;</code> é‡Œé¢ä½¿ç”¨çš„åŒ…ï¼Œåœ¨cliå®šä¹‰buildå‘½ä»¤çš„ä»£ç é‡Œå¯ä»¥çœ‹åˆ°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">&#39;build&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;build for production&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usage</span><span class="token operator">:</span> <span class="token string">&#39;vue-cli-service build [options] [entry|pattern]&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token string-property property">&#39;--no-module&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">build app without generating &lt;script type=&quot;module&quot;&gt; chunks for modern browsers</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥packageä¸­buildå‘½ä»¤æ”¹ä¸º <code>vue-cli-service build --mode production --no-module</code> å³å¯ã€‚</p><h3 id="_2ã€hard-source-webpack-plugin" tabindex="-1"><a class="header-anchor" href="#_2ã€hard-source-webpack-plugin" aria-hidden="true">#</a> 2ã€hard-source-webpack-plugin</h3><p>ç›´æ¥åˆ æ‰å°±å¯ä»¥äº†ï¼Œwebpack5 çš„å¼ºå¤§ç¼“å­˜ï¼Œå¯ä»¥ä¿è¯å¼€å‘ç¯å¢ƒçš„äºŒæ¬¡æ„å»ºé€Ÿåº¦ç›´æ¥èµ·é£ğŸ›«ï¸ã€‚</p><h3 id="_3ã€prerender-spa-plugin" tabindex="-1"><a class="header-anchor" href="#_3ã€prerender-spa-plugin" aria-hidden="true">#</a> 3ã€prerender-spa-plugin</h3>`,8),u={href:"https://github.com/webpack/webpack/pull/9251",target:"_blank",rel:"noopener noreferrer"},d=s("br",null,null,-1),k=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// es6/index.js</span>
<span class="token keyword">const</span> compilerFS <span class="token operator">=</span> compiler<span class="token punctuation">.</span>outputFileSystem

<span class="token keyword">const</span> <span class="token function-variable function">mkdirp</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dir<span class="token punctuation">,</span> opts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    compilerFS<span class="token punctuation">.</span><span class="token function">mkdirp</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> made</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">resolve</span><span class="token punctuation">(</span>made<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥å°±æŠ¥é”™äº†ï¼ŒcompilerFS è¿™ä¸ªå¯¹è±¡ä¸Šå·²ç»æ²¡æœ‰ mkdirp äº†ï¼Œè”ç³»ä¸Šä¸‹æ–‡è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€’å½’åˆ›å»ºç›®å½•ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹ï¼Œwebpackçš„ <code>compiler.outputFileSystem</code> å°±æ˜¯ node çš„fsï¼Œæ‰€ä»¥å¯ä»¥æ›¿æ¢ä¸º <code>compilerFS.mkdir()</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>compilerFS<span class="token punctuation">.</span>mkdir <span class="token operator">===</span> fs<span class="token punctuation">.</span>mkdir <span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ fs.mkdir é»˜è®¤ä¸èƒ½é€’å½’åˆ›å»ºç›®å½•ï¼Œéœ€è¦æºå¸¦ <code>{ recursive: true }</code> é€‰é¡¹ï¼Œæ¥å®ç°ç±»ä¼¼ <code>mkdir(&#39;/ä¸å­˜åœ¨çš„ç›®å½•1/ä¸å­˜åœ¨çš„ç›®å½•2&#39;, opts, () =&gt; {})</code> çš„è°ƒç”¨ã€‚<br> åˆå› ä¸º prerender-spa-plugin è¿™ä¸ªåº“å·²ç»æ²¡äººç»´æŠ¤äº†ï¼Œæ‰€ä»¥åªèƒ½ç”¨patch-packageå»ä¿®æ”¹node_modulesï¼Œä¿®æ”¹åçš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">mkdirp</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dir<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    compilerFS<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> made</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">resolve</span><span class="token punctuation">(</span>made<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ã€preloadplugin" tabindex="-1"><a class="header-anchor" href="#_4ã€preloadplugin" aria-hidden="true">#</a> 4ã€PreloadPlugin</h3>`,6),m={href:"https://github.com/vuejs/vue-cli/issues/7206",target:"_blank",rel:"noopener noreferrer"};function v(b,g){const a=i("ExternalLinkIcon");return o(),c("div",null,[r,s("p",null,[n("è¿™ä¸ªé”™è¯¯æ˜¯webpack5çš„ "),s("a",u,[n("filesystem"),e(a)]),n(" é‡æ„å¯¼è‡´çš„ï¼šâ€œmkdirp is no longer expected to be a function on the output file systemâ€ã€‚"),d,n(" åŒæ—¶ prerender-spa-plugin ä»£ç æ˜¯ä¾èµ– mkdirp è¿™ä¸ªapiçš„ï¼š")]),k,s("p",null,[n("cli5å…³é—­äº†preloadæ’ä»¶ï¼Œ"),s("a",m,[n("æœ‰issueè¦æ‰“å¼€ï¼Œ"),e(a)]),n("ä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥æ²¡å¼€ã€‚ï¼ˆå°å£°bbï¼šè™½ç„¶vue-cliçš„READMEæ ‡æ˜äº†é¡¹ç›®å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œä½†æ˜¯åˆ°ç›®å‰ï¼ˆ10æœˆ12å·ï¼‰ä¸ºæ­¢æœ€è¿‘çš„ä¸€æ¬¡æäº¤è¿˜æ˜¯9æœˆ4å·ï¼Œæˆ‘å¯»æ€è¿™ä¹Ÿå¦¹ç»´æŠ¤å•Šï¼‰")])])}const _=t(l,[["render",v],["__file","vue-cli4å‡5è¸©å‘.html.vue"]]);export{_ as default};
